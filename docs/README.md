# 크리스마스 프로모션

우테코 식당 12월 이벤트 플래너를 개발한다.

## 기능 요구 사항

### 미리보기

```
안녕하세요! 우테코 식당 12월 이벤트 플래너입니다.
12월 중 식당 예상 방문 날짜는 언제인가요? (숫자만 입력해 주세요!)
26
주문하실 메뉴를 메뉴와 개수를 알려 주세요. (e.g. 해산물파스타-2,레드와인-1,초코케이크-1)
타파스-1,제로콜라-1
12월 26일에 우테코 식당에서 받을 이벤트 혜택 미리 보기!

<주문 메뉴>
타파스 1개
제로콜라 1개

<할인 전 총주문 금액>
8,500원

<증정 메뉴>
없음

<혜택 내역>
없음

<총혜택 금액>
0원

<할인 후 예상 결제 금액>
8,500원

<12월 이벤트 배지>
없음
```

### 명세

#### UI

* 식당 예상 방문 날짜를 입력 받는다.
    * 예외 처리 - 추가 예정
* 주문할 메뉴와 수량을 입력 받는다.
    * 예외 처리 - 추가 예정
* 처리 결과를 출력한다.
    * 주문 내역을 출력한다.
    * 할인 전 총 주문 금액을 출력한다.
    * 증정 메뉴를 출력한다.
    * 혜택 내역을 출력한다.
    * 총 혜택 금액을 출력한다.
    * 할인 후 예상 결제 금액을 출력한다.
    * 12월 이벤트 배지를 출력한다.

#### 비즈니스 로직

* 조건에 따라 할인 금액의 로직을 가진다.
    * 공통 - 할인 전 총 금액이 10000원 이상이어야 적용된다.
* 식당 방문 날짜와 주문 메뉴가 주어지면:
    * 주문 내역을 저장한다.
    * 주문 총액을 계산한다.
    * 혜택을 계산한다.
        * 크리스마스 디데이 할인 금액을 계산한다.
        * 평일 할인 금액을 계산한다.
        * 주말 할인 금액을 계산한다.
        * 특별 할인을 계산한다.
        * 증정 이벤트를 계산한다. (혜택으로 간주하지만 할인 총액에서 제함에 유의)
    * 총 혜택 금액을 계산한다.
    * 혜택 금액에 따라 뱃지를 부여한다.

---

# 기능 명세

* [x] 메뉴와 가격을 올바르게 등록한다

```
<애피타이저>
양송이수프(6,000), 타파스(5,500), 시저샐러드(8,000)

<메인>
티본스테이크(55,000), 바비큐립(54,000), 해산물파스타(35,000), 크리스마스파스타(25,000)

<디저트>
초코케이크(15,000), 아이스크림(5,000)

<음료>
제로콜라(3,000), 레드와인(60,000), 샴페인(25,000)
```

* [x] 할인 이벤트를 모두 등록한다.
    * [x] 크리스마스 디데이 할인
    * [x] 평일 할인
    * [x] 주말 할인
    * [x] 특별 할인
    * [x] 증정 이벤트

```
크리스마스 디데이 할인 
    이벤트 기간: 2023.12.1 ~ 2023.12.25
    1,000원으로 시작하여 크리스마스가 다가올수록 날마다 할인 금액이 100원씩 증가
    총주문 금액에서 해당 금액만큼 할인
    (e.g. 시작일인 12월 1일에 1,000원, 2일에 1,100원, ..., 25일엔 3,400원 할인)
평일 할인(일요일~목요일): 평일에는 디저트 메뉴를 메뉴 1개당 2,023원 할인
주말 할인(금요일, 토요일): 주말에는 메인 메뉴를 메뉴 1개당 2,023원 할인
특별 할인: 이벤트 달력에 별이 있으면 총주문 금액에서 1,000원 할인
증정 이벤트: 할인 전 총주문 금액이 12만 원 이상일 때, 샴페인 1개 증정
이벤트 기간: '크리스마스 디데이 할인'을 제외한 다른 이벤트는 2023.12.1 ~ 2023.12.31 동안 적용
```

* [x] 이벤트 배지 부여

```
총혜택 금액에 따라 다른 이벤트 배지를 부여합니다. 이 배지는 2024 새해 이벤트에서 활용할 예정입니다. 배지에 따라 새해 이벤트 참여 시, 각각 다른 새해 선물을 증정할 예정입니다.
    5천 원 이상: 별
    1만 원 이상: 트리
    2만 원 이상: 산타
```

* [x] 이벤트 주의 사항

```
고객에게 안내할 이벤트 주의 사항
총주문 금액 10,000원 이상부터 이벤트가 적용됩니다.
음료만 주문 시, 주문할 수 없습니다.
메뉴는 한 번에 최대 20개까지만 주문할 수 있습니다.
(e.g. 시저샐러드-1, 티본스테이크-1, 크리스마스파스타-1, 제로콜라-3, 아이스크림-1의 총개수는 7개)
```

* [x] 개발 요청 사항
    * [x] 방문 날짜, 메뉴를 선택하면 주문메뉴, 할인 전 총주문 금액, 증정 메뉴, 혜택 내역, 총혜택 금액, 할인 후 예상 결제 금액을 보여줌
    * [x] 방문 날짜를 입력받음
    * [x] 메뉴를 입력받음
    * [x] 주문 메뉴 출력 (순서는 자유롭게)
    * [x] 이벤트 배지 이름 출력
        * [x] 총혜택 금액 = 할인 금액 합계 + 증정 메뉴 가격
    * [x] 할인 후 예상 결제 금액 = 할인 전 총주문 금액 - 할인 금액
    * [x] 증정 메뉴
        * [x] 증정 이벤트에 해당하지 않는 경우, 증정 메뉴 "없음"으로 보여줌
    * [x] 혜택 내역
        * [x] 혜택 내역은 순서 무관
        * [x] 적용된 이벤트가 하나도 없다면 혜택 내역 "없음"으로 보여줌
    * [x] 이벤트 배지
        * [x] 이벤트 배지가 부여되지 않는 경우, "없음"으로 보여줌

```
고객들이 식당에 방문할 날짜와 메뉴를 미리 선택하면 이벤트 플래너가 주문 메뉴, 할인 전 총주문 금액, 증정 메뉴, 혜택 내역, 총혜택 금액, 할인 후 예상 결제 금액, 12월 이벤트 배지 내용을 보여주기를 기대합니다.
12월 중 식당 예상 방문 날짜는 언제인가요? (숫자만 입력해 주세요!)
    방문할 날짜는 1 이상 31 이하의 숫자로만 입력받아 주세요.
    1 이상 31 이하의 숫자가 아닌 경우, "[ERROR] 유효하지 않은 날짜입니다. 다시 입력해 주세요."라는 에러 메시지를 보여 주세요.
    모든 에러 메시지는 "[ERROR]"로 시작하도록 작성해 주세요.
    주문하실 메뉴와 개수를 알려 주세요. (e.g. 해산물파스타-2,레드와인-1,초코케이크-1)
고객이 메뉴판에 없는 메뉴를 입력하는 경우, "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 보여 주세요.
    메뉴의 개수는 1 이상의 숫자만 입력되도록 해주세요. 이외의 입력값은 "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 보여 주세요.
    메뉴 형식이 예시와 다른 경우, "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 보여 주세요.
    중복 메뉴를 입력한 경우(e.g. 시저샐러드-1,시저샐러드-1), "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 보여 주세요.
    모든 에러 메시지는 "[ERROR]"로 시작하도록 작성해 주세요.
주문 메뉴의 출력 순서는 자유롭게 출력해 주세요.
총혜택 금액에 따라 이벤트 배지의 이름을 다르게 보여 주세요.
총혜택 금액 = 할인 금액의 합계 + 증정 메뉴의 가격
할인 후 예상 결제 금액 = 할인 전 총주문 금액 - 할인 금액
증정 메뉴
증정 이벤트에 해당하지 않는 경우, 증정 메뉴 "없음"으로 보여 주세요.
혜택 내역
고객에게 적용된 이벤트 내역만 보여 주세요.
적용된 이벤트가 하나도 없다면 혜택 내역 "없음"으로 보여 주세요.
혜택 내역에 여러 개의 이벤트가 적용된 경우, 출력 순서는 자유롭게 출력해주세요.
이벤트 배지
이벤트 배지가 부여되지 않는 경우, "없음"으로 보여 주세요.
적용된 이벤트가 하나도 없는 경우는 아래 예시를 참고해 주세요.
```

# 클래스 디자인 / TODO

## 전반

* [x] 리팩토링: `Calendar`를 `LocalDate` 타입으로 수정한다.
* [ ] 매직 리터럴과 매직 넘버를 분리한다.

## Exception

* [ ] IllegalArgumentException을 상속하는 EventPlannerException을 만든다.

## Constant

* [ ] `Badge`: `enum`으로 만든다.

## DTO

* [ ] `ReservationDate`
* [ ] `MenuItems` : 일급 컬렉션
    * [ ] `MenuItem` : 패키지 위치 옮기기
* [ ] `BenefitItems` : 일급 컬렉션
    * [ ] `BenefitItem` : 패키지 위치 옮기기
* [ ] `Money`: `int`를 `Money`로 래핑한다.


## Model

* [ ] `Menu`를 Enum 형식으로 저장할 수 있도록 리팩토링한다.
* [ ] 혜택을 `Benefit`으로 저장하고, 증정과 할인의 타입을 분리한다.
    * [ ] `Benefit`에 `type`을 추가한다. `Discount`와 `Freebie`를 받는다.
* [ ] `Badge`: `enum`으로 만든다.

### EventPlanner

* 최초 개발 - 리팩토링 염두에 두고 통자로 개발한다
* [x] 예약 일자를 저장한다
    * [x] 검증 로직을 구현한다.
        * 2023년 12월인지 확인한다.
* [x] 주문 내역을 저장한다
    * [x] 주문 내역을 저장한다
        * [x] `List<MenuItem>` 형태로 받도록 리팩토링한다.
        * [x] 검증 로직을 구현한다.
            * 개별 메뉴 항목에 대한 검증은 제외한다.
            * 메뉴 목록에 메뉴가 존재하는지 확인한다.
            * 중복 메뉴가 있는지 확인한다.
            * 음료만 주문되었는지 확인한다.
            * 메뉴의 총 수량이 20개를 초과하는지 확인한다.
    * [x] 주문 내역을 반환한다
* [x] 주문 총액을 계산한다
    * [x] 주문 총액을 계산한다
    * [x] 주문 총액을 반환한다
* [ ] 혜택을 계산한다
    * [ ] 모든 혜택은 할인 전 총 금액이 1만원 이상일 때 적용된다.
    * [x] 크리스마스 디데이 할인 금액을 계산한다
    * [x] 평일 할인 금액을 계산한다
    * [x] 주말 할인 금액을 계산한다
    * [x] 특별 할인을 계산한다
    * [x] 증정 이벤트를 계산한다
    * [x] 혜택 총액을 계산한다
    * [x] 할인에 따른 결제 금액을 계산한다
    * [x] 혜택 내역을 반환한다
    * [x] 혜택 금액에 따라 뱃지를 부여한다

## Controller - EventPlannerController

* [x] UI로부터 입력을 받아 도메인으로 전달한다.
    * UI로부터 입력을 (DTO 형태로 포장해) 받는다.
    * 입력을 (형식 레벨에서) 검증하고 (DTO로 포장해) 파싱한다
    * (DTO를) 도메인에 전달한다
    * [x] 받아야 할 내용
        * [x] 방문 날짜
        * [x] 주문 메뉴
    * [x] 추가: 예외 발생 시 다시 입력받는다. (다시 입력 로직의 책임은 View가 아닌 Controller가 담당)
* [x] 도메인으로부터 결과를 받아 UI로 전달한다
    * [x] 도메인으로부터 결과를 받는다
    * [x] UI 레이어에 그대로 보낸다
    * [x] exception 발생 시 출력 후 재시작한다.

### TryUntilSuccess

* [x] 메서드와 뷰를 받는다.
* [x] 메서드를 실행하고, 예외 발생 시 메시지를 출력하고 다시 실행한다.

## Parser

### Parser(interface)

* [x] 인터페이스를 정의한다.

### DayDateParser

* [x] IO 인터페이스를 구현한다.
    * [x] LocalDate 형태로 리턴한다.
    * [x] validate를 구현한다.
        * 정수형(decimal)이다.
        * 1~31 사이이다.

### OrderParser

* [x] 인터페이스를 정의한다.
    * [x] Map 형태로 리턴한다.
    * [x] `List<MemuItem>` 형태로 리턴하도록 리팩토링한다.
    * [x] validation 기능을 구현한다.
        * 각 항목은 쉼표`,`로 구분되어진다.
        * 각 항목은 `메뉴명-정수`의 형식이다.
        * 정수는 `1` 이상이다.

## View

### io.IO

* [x] 인터페이스를 정의한다.

### io.ConsoleIO

* [x] IO 인터페이스를 구현한다.

### InputView

* [x] 방문 날짜를 입력 받는다
    * [x] 방문 날짜를 입력 받는다
    * [x] 입력 받은 방문 날짜를 (DTO로 포장해) 반환한다
* [x] 주문 메뉴를 입력 받는다
    * [x] 주문 메뉴를 입력 받는다
    * [x] 입력 받은 주문 메뉴를 (DTO로 포장해) 반환한다

### OutputView

* [x] 타이틀 등 Magic Literal을 출력한다
* [x] 주문 내역을 출력한다
* [x] 할인 전 총 주문 금액을 출력한다
* [x] 증정 메뉴를 출력한다
    * [x] 없으면 `없음`을 출력한다
* [x] 혜택 내역을 출력한다
    * [x] 없으면 `없음`을 출력한다
* [x] 총 혜택 금액을 출력한다
    * [x] 없으면 `없음`을 출력한다
* [x] 할인 후 예상 결제 금액을 출력한다
* [x] 12월 이벤트 배지를 출력한다

### ExceptionView

* [x] 예외 메시지를 출력한다